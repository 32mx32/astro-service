---
// –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ Tailwind
import '../styles/global.css';
// –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ–º
import '../styles/theme.css';
// –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º ThemeProvider –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ–º–æ–π
import ThemeProvider from '../context/ThemeProvider.astro';
import Navbar from '../components/navbar/Navbar.astro';

interface Props {
	title?: string;
}

const { title = "Astro –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –ü—Ä–æ–µ–∫—Ç" } = Astro.props;
---

<!doctype html>
<html lang="ru" class="scroll-smooth">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="generator" content={Astro.generator} />
		<title>{Astro.props.title || 'Astro –°–∞–π—Ç'}</title>
		
		<!-- –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –º–∏–≥–∞–Ω–∏—è —Ç–µ–º—ã -->
		<script is:inline>
			// –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–æ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –º–∏–≥–∞–Ω–∏—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ç–µ–º—ã
			(function() {
				function getThemePreference() {
					// –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ localStorage
					const savedTheme = typeof localStorage !== 'undefined' && localStorage.getItem('theme');
					if (savedTheme) {
						return savedTheme;
					}
					
					// –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
					if (typeof window !== 'undefined' && window.matchMedia) {
						return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
					}
					
					// –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–≤–µ—Ç–ª—É—é —Ç–µ–º—É
					return 'light';
				}
				
				// –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–º—É –∫ HTML-—Ç–µ–≥—É
				const theme = getThemePreference();
				if (theme === 'dark') {
					document.documentElement.classList.add('dark');
				} else {
					document.documentElement.classList.remove('dark');
				}
				
				// –°–æ–∑–¥–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–µ–º–æ–π
				window.themeManager = {
					getTheme: function() {
						return document.documentElement.classList.contains('dark') ? 'dark' : 'light';
					},
					setTheme: function(newTheme) {
						if (newTheme === 'dark') {
							document.documentElement.classList.add('dark');
							localStorage.setItem('theme', 'dark');
						} else {
							document.documentElement.classList.remove('dark');
							localStorage.setItem('theme', 'light');
						}
						// –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–µ–º—ã
						document.dispatchEvent(new CustomEvent('themeChanged', { detail: { theme: newTheme } }));
					},
					toggle: function() {
						const currentTheme = this.getTheme();
						const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
						this.setTheme(newTheme);
						return newTheme;
					}
				};
			})();
		</script>
		
		<!-- –°–∫—Ä–∏–ø—Ç –¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
		<script src="/scripts/client-navigation.js" is:inline></script>
		
		<!-- –î–µ–±–∞–≥–≥–µ—Ä –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
		<script src="/scripts/client-navigation-debug.js" is:inline></script>
		
		<style>
			/* –°—Ç–∏–ª–∏ –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ theme.css, –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ */
			body {
				margin: 0;
				overflow: hidden;
				font-size: 16px;
				font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
				background-color: var(--background-color);
				color: var(--text-color);
				position: relative;
			}
			
			canvas {
				background: var(--background-color);
				width: 100vw;
				height: 100vh;
			}
			
			/* –°—Ç–∏–ª–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
			.client-navigation-transition {
				animation: fadeIn 0.3s ease forwards;
			}
			
			/* –°—Ç–∏–ª—å –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
			.content-wrapper {
				opacity: 0;
				animation: fadeIn 0.5s ease forwards;
				animation-delay: 0.1s;
			}
			
			/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
			.page-loader {
				position: fixed;
				top: 0;
				left: 0;
				width: 100%;
				height: 3px;
				background-color: transparent;
				z-index: 9999;
			}
			
			.page-loader::after {
				content: '';
				display: block;
				height: 100%;
				width: 0;
				background: linear-gradient(to right, var(--particle-colors));
				animation: loading 2s ease-in-out infinite;
			}
			
			body[data-navigating="true"] .page-loader {
				display: block;
			}
			
			body:not([data-navigating="true"]) .page-loader {
				display: none;
			}
			
			@keyframes fadeIn {
				from { opacity: 0; }
				to { opacity: 1; }
			}
			
			/* –°—Ç–∏–ª–∏ –¥–ª—è –æ–≤–µ—Ä–ª–µ—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–∞—Ö */
			.navigation-progress {
				position: fixed;
				top: 0;
				left: 0;
				width: 100%;
				height: 3px;
				background: var(--background-color);
				z-index: 9999;
			}
			
			.navigation-progress::after {
				content: '';
				display: block;
				height: 100%;
				width: 0;
				background: linear-gradient(to right, var(--particle-colors));
				animation: loading 2s cubic-bezier(0.17, 0.67, 0.83, 0.67) infinite;
			}
			
			/* –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ */
			.content-area {
				transition: opacity 0.3s ease, transform 0.3s ease;
			}
			
			.content-area.fade-out {
				opacity: 0;
				transform: translateY(10px);
			}
			
			.content-area.fade-in {
				animation: fadeInContent 0.5s ease forwards;
			}
			
			@keyframes fadeInContent {
				from { 
					opacity: 0;
					transform: translateY(-10px);
				}
				to {
					opacity: 1;
					transform: translateY(0);
				}
			}
			
			@keyframes loading {
				0% { width: 0; }
				50% { width: 50%; }
				100% { width: 100%; }
			}
		</style>
	</head>
	<body>
		<!-- –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º –≤–µ—Å—å –∫–æ–Ω—Ç–µ–Ω—Ç –≤ ThemeProvider -->
		<ThemeProvider defaultTheme="system" enableSystem={true}>
			<!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
			<div class="page-loader"></div>
			
			<div id="app" class="content-wrapper">
				<Navbar />
				<slot />
			</div>
		</ThemeProvider>
		
		<script>
			// –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ–º–æ–π
			document.addEventListener('DOMContentLoaded', () => {
				const themeToggle = document.getElementById('theme-toggle');
				
				// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–Ω–∞—á–∫–æ–≤
				function updateToggleIcons() {
					const sunIcon = document.querySelector('.sun-icon');
					const moonIcon = document.querySelector('.moon-icon');
					
					if (sunIcon && moonIcon) {
						const isDark = document.documentElement.classList.contains('dark');
						// –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –≤–º–µ—Å—Ç–æ display –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞
						sunIcon.style.opacity = isDark ? '0' : '1';
						moonIcon.style.opacity = isDark ? '1' : '0';
					}
				}
				
				// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã
				if (themeToggle) {
					themeToggle.addEventListener('click', () => {
						// –ò—Å–ø–æ–ª—å–∑—É–µ–º API ThemeManager
						if (window.themeManager) {
							window.themeManager.toggle();
							updateToggleIcons();
						}
					});
					
					// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
					updateToggleIcons();
					
					// –ü—Ä–æ—Å–ª—É—à–∏–≤–∞–µ–º —Å–æ–±—ã—Ç–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–µ–º—ã
					document.addEventListener('themeChanged', () => {
						updateToggleIcons();
						
						// –í—ã–∑—ã–≤–∞–µ–º –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫—É –∞–Ω–∏–º–∞—Ü–∏–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ç–µ–º—ã
						if (window.initScene) {
							window.initScene();
						}
					});
				}
				
				// –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
				function setNavigationStatus(isNavigating) {
					document.body.setAttribute('data-navigating', isNavigating ? 'true' : 'false');
				}
				
				// –ù–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ - –Ω–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
				setNavigationStatus(false);
				
				// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞—á–∞–ª–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
				document.addEventListener('clientNavigationStart', () => {
					setNavigationStatus(true);
					
					// –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
					const contentAreas = document.querySelectorAll('.content-area');
					contentAreas.forEach(area => {
						area.classList.add('fade-out');
					});
				});
				
				// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
				document.addEventListener('clientNavigationComplete', (e) => {
					console.log('–ù–∞–≤–∏–≥–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞:', e.detail.url);
					
					setNavigationStatus(false);
					
					// –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º canvas, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
					const canvas = document.getElementById('scene');
					if (canvas) {
						// –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–æ–¥–∏—Ç–µ–ª—è
						const parent = canvas.parentNode;
						// –ö–ª–æ–Ω–∏—Ä—É–µ–º canvas
						const newCanvas = canvas.cloneNode(false);
						// –ó–∞–º–µ–Ω—è–µ–º —Å—Ç–∞—Ä—ã–π canvas –Ω–æ–≤—ã–º
						parent.replaceChild(newCanvas, canvas);
						
						console.log('üîÑ Canvas –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã:', e.detail.url);
					}
					
					// –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é —á–∞—Å—Ç–∏—Ü –ø–æ—Å–ª–µ –ø–µ—Ä–µ—Ö–æ–¥–∞
					if (window.fullRestart) {
						// –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é DOM
						setTimeout(() => window.fullRestart(), 50);
					} else if (window.initScene) {
						// –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é DOM
						setTimeout(() => window.initScene(), 50);
					}
					
					// –û–±–Ω–æ–≤–ª—è–µ–º –∏–∫–æ–Ω–∫–∏ —Ç–µ–º—ã
					updateToggleIcons();
					
					// –ü—Ä–∏–º–µ–Ω—è–µ–º –∫–ª–∞—Å—Å –∞–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è
					const contentWrappers = document.querySelectorAll('.content-area');
					contentWrappers.forEach(wrapper => {
						wrapper.classList.remove('fade-out');
						wrapper.classList.add('fade-in');
						setTimeout(() => {
							wrapper.classList.remove('fade-in');
						}, 500);
					});
				});
			});
		</script>
	</body>
</html>

<!-- –£–¥–∞–ª—è–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Å—Ç–∏–ª–∏, —Ç–∞–∫ –∫–∞–∫ –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Tailwind -->
